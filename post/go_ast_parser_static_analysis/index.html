<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Goの標準パッケージではじめる静的解析入門①準備編"><meta property="og:description" content="Go言語では、標準パッケージであるgoパッケージが字句解析や構文解析を行う機能を提供しています。go/astやgo/parserを使って構文解析のはじめの一歩を踏み出してみます。今回は用語や利用するパッケージの説明をして、静的解析をはじめる準備をします。"><meta property="og:type" content="article"><meta property="og:url" content="https://mom0tomo.github.io/post/go_ast_parser_static_analysis/"><meta property="og:image" content="https://mom0tomo.github.io/images/articles/gopher.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-03-10T23:52:21+09:00"><meta property="article:modified_time" content="2019-03-10T23:52:21+09:00"><meta property="og:site_name" content="mom0tomo.github.io"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mom0tomo.github.io/images/articles/gopher.png"><meta name=twitter:title content="Goの標準パッケージではじめる静的解析入門①準備編"><meta name=twitter:description content="Go言語では、標準パッケージであるgoパッケージが字句解析や構文解析を行う機能を提供しています。go/astやgo/parserを使って構文解析のはじめの一歩を踏み出してみます。今回は用語や利用するパッケージの説明をして、静的解析をはじめる準備をします。"><meta name=twitter:site content="@https://twitter.com/mom0tomo"><meta name=description content="Go言語では、標準パッケージであるgoパッケージが字句解析や構文解析を行う機能を提供しています。go/astやgo/parserを使って構文解析のはじめの一歩を踏み出してみます。今回は用語や利用するパッケージの説明をして、静的解析をはじめる準備をします。"><meta name=generator content="Hugo 0.99.0"><title>Goの標準パッケージではじめる静的解析入門①準備編 &#183; mom0tomo</title><link rel="shortcut icon" href=https://mom0tomo.github.io/images/favicon.ico><link rel=stylesheet href=https://mom0tomo.github.io/css/style.css><link rel=stylesheet href=https://mom0tomo.github.io/css/highlight.css><link rel=stylesheet href=https://mom0tomo.github.io/css/monosocialiconsfont.css><link href=https://mom0tomo.github.io/index.xml rel=alternate type=application/rss+xml title=mom0tomo><link rel=stylesheet href=https://mom0tomo.github.io/css/custom.css></head><body><nav class=main-nav><a href=https://mom0tomo.github.io/><span class=arrow>← </span>Home</a>
<a href=https://mom0tomo.github.io/about>About</a>
<a href=https://mom0tomo.github.io/post>Archive</a>
<a href=https://mom0tomo.github.io/tags>Tags</a>
<a href=https://mom0tomo.github.io//index.xml class=symbol style=font-size:15px>rss</a></nav><section id=wrapper><article class=post><header><h1>Goの標準パッケージではじめる静的解析入門①準備編</h1><div class=posted style=display:none><a href=https://mom0tomo.github.io/post/go_ast_parser_static_analysis/>Goの標準パッケージではじめる静的解析入門①準備編</a></div><h2 class=headline>Mar 10, 2019 23:52
· 1205 words
· 3 minutes read
<span class=tags><a href=https://mom0tomo.github.io/tags/go>Go</a>
<a href=https://mom0tomo.github.io/tags/%E9%9D%99%E7%9A%84%E8%A7%A3%E6%9E%90>静的解析</a></span></h2></header><div id=toc><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a><ul><li><a href=#参考>参考</a></li></ul></li><li><a href=#用語説明>用語説明</a><ul><li><a href=#静的解析とは>静的解析とは</a></li><li><a href=#抽象構文木astとは>抽象構文木(AST)とは</a></li><li><a href=#トラバース走査とは>トラバース(走査)とは</a></li></ul></li><li><a href=#やること>やること</a></li><li><a href=#やらないこと>やらないこと</a></li><li><a href=#字句解析で利用するパッケージ>字句解析で利用するパッケージ</a><ul><li><a href=#goscannerhttpsgodocorggoscanner><a href=https://godoc.org/go/scanner>go/scanner</a></a></li><li><a href=#gotokenhttpsgolangorgpkggotoken><a href=https://golang.org/pkg/go/token/>go/token</a></a></li></ul></li><li><a href=#構文解析で利用するパッケージ>構文解析で利用するパッケージ</a><ul><li><a href=#goparserhttpsgodocorggoparser><a href=https://godoc.org/go/parser>go/parser</a></a></li><li><a href=#goasthttpsgodocorggoast><a href=https://godoc.org/go/ast>go/ast</a></a></li></ul></li><li><a href=#おわりに>おわりに</a></li></ul></nav></div><section id=post-body><h2 id=はじめに>はじめに</h2><p>Go言語では、標準パッケージであるgoパッケージが字句解析や構文解析を行う機能を提供しています。</p><p>go/astやgo/parserを使って構文解析のはじめの一歩を踏み出してみます。</p><h3 id=参考>参考</h3><ul><li><a href=https://qiita.com/tenntenn/items/868704380455c5090d4b>Qiita | goパッケージで簡単に静的解析して世界を広げよう #golang</a>
静的解析を学ぶ際に参考になる記事のまとめ（tenntennさん筆）</li></ul><hr><h2 id=用語説明>用語説明</h2><h3 id=静的解析とは>静的解析とは</h3><p>静的コード解析、静的プログラム解析とも言います。
ソースコードを <em><strong>実行することなく</strong></em> 解析を行うことを指します。</p><p>対義語は動的解析で、ソースコードを実行して解析を行うことを表します。
こちらはプログラマが普段行なっているような検証方法です。</p><h3 id=抽象構文木astとは>抽象構文木(AST)とは</h3><p>abstract syntax tree.
構文解析の経過や結果から、言語の意味に関係ない情報を取り除き、意味に関係ある情報のみを取り出したツリー状（木）のデータ構造のことです。
<a href=https://ja.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E6%A7%8B%E6%96%87%E6%9C%A8>Wikipedia | 抽象構文木</a></p><h3 id=トラバース走査とは>トラバース(走査)とは</h3><p>抽象構文木のような木構造の各ノードを探索、調査することです。
ノードとは、下記の図でいうところのA,B,C&mldr;が書いてあるそれぞれの◯を指します。
<a href=https://ja.wikipedia.org/wiki/%E6%9C%A8%E6%A7%8B%E9%80%A0_(%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0)#%E8%B5%B0%E6%9F%BB%E6%B3%95>Wikipedia | 木構造(データ構造)#走査法</a></p><p><img src=/images/articles/tree.png alt=木構造></p><h2 id=やること>やること</h2><ul><li>字句解析/構文解析</li><li>抽象構文木(AST)のトラバース</li><li>位置情報の取得</li><li>型情報の取得</li></ul><p>静的解析を行うための機能が提供されている、<a href=https://golang.org/pkg/go/>goパッケージ配下のパッケージ</a>を使います。</p><h2 id=やらないこと>やらないこと</h2><ul><li>静的解析のモジュール化</li><li>golang.org/x/tools/go/analysisパッケージの解説</li></ul><p>実用の視点に立ったモジュール化の手法については、tenntennさんの記事をご覧下さい。</p><p><a href=https://tech.mercari.com/entry/2018/12/16/150000>Goにおける静的解析のモジュール化について</a></p><hr><h2 id=字句解析で利用するパッケージ>字句解析で利用するパッケージ</h2><h3 id=goscannerhttpsgodocorggoscanner><a href=https://godoc.org/go/scanner>go/scanner</a></h3><p>字句解析を行う際に使うパッケージです。</p><p><code>scanner/Scan</code>関数を使い、ソースコードを読み込み、トークンの位置、トークン、srcで与えた値の文字列リテラルを取得します。</p><p><a href=https://godoc.org/go/scanner#Scanner.Scan>scanner/Scan</a></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> (s *Scanner) <span style=color:#447fcf>Scan</span>() (pos token.Pos, tok token.Token, lit <span style=color:#6ab825;font-weight:700>string</span>)
</span></span></code></pre></div><h3 id=gotokenhttpsgolangorgpkggotoken><a href=https://golang.org/pkg/go/token/>go/token</a></h3><p>字句解析を行う際に使うパッケージです。</p><p>ファイルの位置や長さに関する情報を保持する構造体(token.FileSet型)です。</p><p><a href=https://godoc.org/go/token#FileSet>token/FileSet</a></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6ab825;font-weight:700>type</span> FileSet <span style=color:#6ab825;font-weight:700>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic>// contains filtered or unexported fields
</span></span></span><span style=display:flex><span><span style=color:#999;font-style:italic></span>}
</span></span></code></pre></div><p><code>scanner/Scan</code>などを使って取得するトークンの位置情報は絶対的なものではなく、<code>token.FileSet</code>を基準として相対的に決められます。</p><h2 id=構文解析で利用するパッケージ>構文解析で利用するパッケージ</h2><h3 id=goparserhttpsgodocorggoparser><a href=https://godoc.org/go/parser>go/parser</a></h3><p>構文解析を行う際に使うパッケージです。</p><p>ソースコードを字句解析し、構文解析を行い、抽象構文木(AST)まで作ってくれます。</p><p>文字列をパースするために、<code>parser.ParseExpr</code>関数を使います。</p><p><a href=https://godoc.org/go/parser#ParseExpr>parser/ParseExpr</a></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>ParseExpr</span>(x <span style=color:#6ab825;font-weight:700>string</span>) (ast.Expr, <span style=color:#6ab825;font-weight:700>error</span>)
</span></span></code></pre></div><h3 id=goasthttpsgodocorggoast><a href=https://godoc.org/go/ast>go/ast</a></h3><p>抽象構文木(AST)を定義したパッケージです。</p><p>抽象構文木（AST）をトラバースするために、<code>ast.Inspect</code>関数を使います。</p><p><a href=https://godoc.org/go/ast#Inspect>ast/Inspect</a></p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>Inspect</span>(node Node, f <span style=color:#6ab825;font-weight:700>func</span>(Node) <span style=color:#6ab825;font-weight:700>bool</span>)
</span></span></code></pre></div><hr><h2 id=おわりに>おわりに</h2><p>今回は用語や利用する標準パッケージについて説明しました。</p><p><a href=https://mom0tomo.github.io/post/go_ast_parser_static_analysis_2>次回</a>は静的解析を行う際の流れを確認します。</p></section></article><div class=social><div class=social-inner><a href=https://twitter.com/share class=twitter-share-button data-count=horizontal lang=hja>Tweet</a>
<script>!function(e,n,s){var t,o=e.getElementsByTagName(n)[0],i=/^http:/.test(e.location)?"http":"https";e.getElementById(s)||(t=e.createElement(n),t.id=s,t.src=i+"://platform.twitter.com/widgets.js",o.parentNode.insertBefore(t,o))}(document,"script","twitter-wjs")</script><a href=http://b.hatena.ne.jp/entry/ class=hatena-bookmark-button data-hatena-bookmark-layout=simple-balloon title=このエントリーをはてなブックマークに追加><img src=https://b.st-hatena.com/images/entry-button/button-only@2x.png alt=このエントリーをはてなブックマークに追加 width=20 height=20 style=border:none></a>
<script type=text/javascript src=https://b.st-hatena.com/js/bookmark_button.js async></script>
<a data-pocket-label=pocket data-pocket-count=horizontal class=pocket-btn data-lang=en></a>
<script type=text/javascript>!function(e,t){if(!e.getElementById(t)){var s,n=e.createElement("script");n.id=t,n.src="https://widgets.getpocket.com/v1/j/btn.js?v=1",s=e.getElementById(t),e.body.appendChild(n)}}(document,"pocket-btn-js")</script></div></div><nav id=post-nav><span class=prev><a href=https://mom0tomo.github.io/post/webpack_loader_test/>← webpack.config.jsでloader対象を指定するプロパティ名が test なのはなぜ？</a></span>
<span class=next><a href=https://mom0tomo.github.io/post/go_ast_parser_static_analysis_2/>Goの標準パッケージではじめる静的解析入門②解析編 →</a></span></nav><div class=related-posts><h4>関連記事</h4><ul><li><a href=/post/go_ast_parser_static_analysis_3/>Goの標準パッケージではじめる静的解析入門③実践編</a></li><li><a href=/post/go_ast_parser_static_analysis_2/>Goの標準パッケージではじめる静的解析入門②解析編</a></li><li><a href=/post/go-appengine-update-112/>GAE上で動くアプリケーションをGo1.12にアップデートする上でやったこと</a></li></ul></div><footer id=footer><div id=social><a class=symbol href=https://www.facebook.com/mom0tomo>circlefacebook</a>
<a class=symbol href=https://github.com/mom0tomo>circlegithub</a>
<a class=symbol href=https://twitter.com/mom0tomo>circletwitterbird</a></div><p class=small>© Copyright 2022 mom0tomo</p></footer></section><script src=https://mom0tomo.github.io/js/jquery-3.3.1.min.js></script>
<script src=https://mom0tomo.github.io/js/main.js></script>
<script src=https://mom0tomo.github.io/js/highlight.pack.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>